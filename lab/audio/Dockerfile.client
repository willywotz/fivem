FROM golang:1.21-alpine AS builder

# Install build dependencies for audio libraries
RUN apk add --no-cache gcc musl-dev alsa-lib-dev

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY main.go .
RUN go build -o audio-client .

FROM alpine:latest
RUN apk --no-cache add ca-certificates alsa-lib
WORKDIR /root/

COPY --from=builder /app/audio-client .

ENV SERVER_URL=http://audio-server:8080

CMD ["./audio-client"]
